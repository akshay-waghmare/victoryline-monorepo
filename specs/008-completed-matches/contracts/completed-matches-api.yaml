openapi: 3.0.0
info:
  title: VictoryLine Completed Matches API
  description: API endpoint for retrieving completed cricket matches
  version: 1.0.0
  contact:
    name: VictoryLine Development Team

servers:
  - url: http://localhost:8080/api/v1
    description: Local development server
  - url: https://api.victoryline.com/api/v1
    description: Production server

paths:
  /matches/completed:
    get:
      summary: Get completed matches
      description: |
        Retrieves up to 20 most recently completed cricket matches. 
        Matches are ordered by completion time (most recent first).
        A match is considered completed when isDeleted=true in the LIVE_MATCH table.
      operationId: getCompletedMatches
      tags:
        - Matches
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Successfully retrieved completed matches
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompletedMatchesResponse'
              examples:
                withMatches:
                  summary: Response with completed matches
                  value:
                    success: true
                    data:
                      - id: 12345
                        url: "https://crex.com/matches/ind-vs-aus-2025"
                        isDeleted: true
                        lastKnownState: "India won by 7 wickets (29 balls remaining)"
                        updatedAt: "2025-12-06T18:30:45.123Z"
                        deletionAttempts: 1
                        isDistributionDone: true
                      - id: 12344
                        url: "https://crex.com/matches/eng-vs-pak-2025"
                        isDeleted: true
                        lastKnownState: "England won by 42 runs"
                        updatedAt: "2025-12-06T15:20:10.456Z"
                        deletionAttempts: 1
                        isDistributionDone: true
                    error: null
                    timestamp: "2025-12-07T10:30:45.123Z"
                emptyList:
                  summary: Response with no completed matches
                  value:
                    success: true
                    data: []
                    error: null
                    timestamp: "2025-12-07T10:30:45.123Z"
        '401':
          description: Unauthorized - JWT token missing or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                data: null
                error:
                  code: "UNAUTHORIZED"
                  message: "Authentication required. Please provide a valid JWT token."
                  field: null
                timestamp: "2025-12-07T10:30:45.123Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                data: null
                error:
                  code: "INTERNAL_SERVER_ERROR"
                  message: "Failed to retrieve completed matches. Please try again later."
                  field: null
                timestamp: "2025-12-07T10:30:45.123Z"

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint

  schemas:
    CompletedMatchesResponse:
      type: object
      required:
        - success
        - data
        - error
        - timestamp
      properties:
        success:
          type: boolean
          description: Indicates whether the request was successful
          example: true
        data:
          type: array
          description: Array of completed match objects (max 20)
          items:
            $ref: '#/components/schemas/LiveMatch'
          nullable: true
        error:
          type: object
          description: Error details (null if success=true)
          nullable: true
          properties:
            code:
              type: string
              description: Machine-readable error code
            message:
              type: string
              description: Human-readable error message
            field:
              type: string
              description: Field name that caused error (if applicable)
              nullable: true
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the response
          example: "2025-12-07T10:30:45.123Z"

    LiveMatch:
      type: object
      description: Live match entity (also used for completed matches)
      required:
        - id
        - url
        - isDeleted
      properties:
        id:
          type: integer
          format: int64
          description: Unique match identifier (auto-increment primary key)
          example: 12345
        url:
          type: string
          maxLength: 500
          description: Unique match URL from crex.com (serves as external ID)
          example: "https://crex.com/matches/ind-vs-aus-2025"
        isDeleted:
          type: boolean
          description: | 
            Soft delete flag. When true, indicates match has completed.
            For completed matches endpoint, this will always be true.
          example: true
        lastKnownState:
          type: string
          description: |
            JSON string or text containing final match result.
            Includes winner information that can be parsed by getWinningTeam() method.
          example: "India won by 7 wickets (29 balls remaining)"
          nullable: true
        deletionAttempts:
          type: integer
          format: int32
          description: Counter for deletion attempts (internal system field)
          example: 1
          default: 0
        isDistributionDone:
          type: boolean
          description: Betting distribution completion flag
          example: true
          default: false
        updatedAt:
          type: string
          format: date-time
          description: |
            Timestamp of last update to this record.
            Used for ordering completed matches (most recent first).
          example: "2025-12-06T18:30:45.123Z"
          nullable: true

    ErrorResponse:
      type: object
      required:
        - success
        - data
        - error
        - timestamp
      properties:
        success:
          type: boolean
          description: Always false for error responses
          example: false
        data:
          type: object
          description: Always null for error responses
          nullable: true
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: Machine-readable error code
              enum:
                - UNAUTHORIZED
                - INTERNAL_SERVER_ERROR
                - DATABASE_ERROR
              example: "INTERNAL_SERVER_ERROR"
            message:
              type: string
              description: Human-readable error message
              example: "Failed to retrieve completed matches. Please try again later."
            field:
              type: string
              description: Field name that caused error (usually null for system errors)
              nullable: true
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp of the response
          example: "2025-12-07T10:30:45.123Z"

tags:
  - name: Matches
    description: Cricket match data endpoints
