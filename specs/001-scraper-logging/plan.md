# Implementation Plan: Scraper Logging Recovery

**Branch**: `001-scraper-logging` | **Date**: 2025-11-05 | **Spec**: specs/001-scraper-logging/spec.md
**Input**: Feature specification from `/specs/001-scraper-logging/spec.md`

**Note**: This implementation plan is generated by `/speckit.plan` and aligns with the project constitution.

## Summary

Enhance the cricket scraper’s observability by emitting structured JSON logs at every critical step, capturing diagnostics when DOM validation or runtime failures occur, and exposing lifecycle signals needed to triage outages quickly. The solution introduces correlation-aware logging middleware, diagnostic artifact capture hooks, and operational safeguards (rotation, retention, redaction) so on-call engineers can restore scraping service reliability without manual instrumentation.

## Technical Context

**Language/Version**: Python 3.10 (compatible with constitution requirement ≥3.8 and current runtime)  
**Primary Dependencies**: Playwright (scraping), Flask (API), Python `logging` + `structlog` adapter for JSON output  
**Storage**: SQLite (existing), file-system artifact cache with optional S3 upload (configurable)  
**Testing**: pytest with Playwright fixtures and snapshot assertions for log payloads  
**Target Platform**: Linux host for scheduled scrapers, Windows-compatible for local debugging  
**Project Type**: Backend service + CLI utilities  
**Performance Goals**: Maintain scrape cycle p95 ≤ 90s while capturing per-stage metrics  
**Constraints**: Log rotation capped at 250MB per node, diagnostic artifact retention ≤14 days, redaction of PII tokens  
**Scale/Scope**: Support 10+ concurrent match scrapes with shared correlation IDs and centralized log shipping

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Reliability First**: Plan introduces retry-aware logging hooks and ensures failures surface with actionable context instead of silent crashes. ✅
- **Data Integrity**: Validation outcomes are logged per URL, enabling auditors to trace rejected data; no data mutation occurs without accompanying logs. ✅
- **API Stability**: No breaking API changes; new health endpoint documented with versioning discipline. ✅
- **Comprehensive Logging**: Feature directly implements structured JSON logs, rotation, and diagnostics aligned with principle IV. ✅
- **Test-Driven Quality**: Plan mandates pytest coverage for log schema, diagnostic capture, and failure injections before rollout. ✅

**Post-Phase-1 Review**: Design artifacts (research, data model, contracts, quickstart) reaffirm compliance with all five principles; no constitution waivers required. ✅

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)
<!--
  ACTION REQUIRED: Replace the placeholder tree below with the concrete layout
  for this feature. Delete unused options and expand the chosen structure with
  real paths (e.g., apps/admin, packages/something). The delivered plan must
  not include Option labels.
-->

```text
src/
├── config.py
├── shared.py
├── crex_main_url.py
├── crex_scraper.py
├── cricket_data_service.py
└── logging/
  ├── adapters.py        # new JSON logger + redaction helpers
  └── diagnostics.py     # artifact capture + retention utilities

tests/
├── unit/
│   ├── test_logging_adapters.py
│   └── test_diagnostics.py
└── integration/
  └── test_scraper_logging_flow.py
```

**Structure Decision**: Extend existing `src/` service layout with a dedicated `logging/` package for observability helpers and add targeted unit/integration tests under `tests/` reflecting constitution expectations.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| _None_ | — | — |
