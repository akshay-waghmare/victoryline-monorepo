<ng-container *ngIf="view$ | async as view; else loadingState">
  <section class="live-hero" [attr.data-status]="view.status">
    <header class="live-hero__headline">
      <div class="live-hero__fixture">
        <span class="live-hero__team" title="{{ view.score.teamName }}">{{ view.score.teamName }}</span>
        <span class="live-hero__status">{{ view.status | titlecase }}</span>
      </div>
      <div class="live-hero__timestamp">
        <span>Updated</span>
        <time [attr.datetime]="view.timestamp">{{ view.timestamp | date:'shortTime' }}</time>
      </div>
    </header>

    <div class="live-hero__grid">
      <!-- LEFT: Score and Team Info -->
      <div class="live-hero__pod live-hero__pod--score">
        <div class="scoreline__team-name">{{ view.score.teamName }}</div>
        <div class="scoreline" aria-label="Current score">
          <span class="scoreline__runs">{{ view.score.runs }}</span>
          <span class="scoreline__separator">/</span>
          <span class="scoreline__wickets">{{ view.score.wickets }}</span>
        </div>
        <div class="scoreline__meta">
          <span>{{ view.score.overs }} ov</span>
          <span>{{ view.score.runRateLabel }}</span>
        </div>
        <div class="recent-balls" *ngIf="view.batters.length && view.batters[0].recentBalls.length">
          <span class="recent-balls__label">This over:</span>
          <ul class="recent-balls__list" aria-label="Recent balls">
            <li class="recent-balls__item" *ngFor="let ball of view.batters[0].recentBalls; trackBy: trackBall">
              {{ ball }}
            </li>
          </ul>
        </div>
      </div>

      <!-- CENTER: Current Ball (Large Circle) -->
      <div class="current-ball" *ngIf="view.score.currentBall">
        <span class="current-ball__value">{{ view.score.currentBall }}</span>
      </div>

      <!-- RIGHT: Chase Context -->
      <div class="live-hero__pod live-hero__pod--context">
        <div class="chase-summary" *ngIf="view.score.resultSummary">
          {{ view.score.resultSummary }}
        </div>
        <div class="chase-summary" *ngIf="!view.score.resultSummary && view.chase.isChasing">
          {{ view.score.teamName }} need {{ view.chase.runsRemaining }} runs in {{ view.chase.ballsRemaining }} balls
        </div>
      </div>
    </div>
  </section>
</ng-container>

<ng-template #loadingState>
  <div class="live-hero live-hero--loading" *ngIf="state$ | async as state">
    <div class="live-hero__loader" aria-busy="true" aria-live="polite">
      <span *ngIf="state.loading">Loading live hero…</span>
      <span *ngIf="!state.loading && !state.view">Awaiting first update…</span>
    </div>
    <div class="live-hero__error" *ngIf="state.error">
      <p>Could not load live data.</p>
      <button type="button" class="retry-button" (click)="retry()">Retry</button>
    </div>
  </div>
</ng-template>

<div class="live-hero__error" *ngIf="(state$ | async)?.error as error">
  <p>{{ error }}</p>
</div>
